<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixel Bug Test</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <title>Sound Activity Detector</title>
    <link href="https://fonts.cdnfonts.com/css/snowmas" rel="styelesheet">
    <style>
      body {
           background-image: url("listening.bug.jpeg");
           background-size: 500px;
           background-repeat: no-repeat;
           background-position: left;
           background-color: #ffcccc;
           background-blend-mode: multiply;
           text-align: center;
           font-family: 'Snowmas', 'Courier New', 'Courier New', Courier, monospace;
           padding-top: 30vh;

      }
       h2{
        color:darkred
       }

       #status{
         font-size: 1.2rem;
         color: green;
         margin-top: 20px;
       }
       </style>
       <body>
        <h2>Sound Activity Detector</h2>
       <p id="status">Waiting for sound...</p>
       <p>Listening for unsual sound activity</p>
        <script>
          navigator.mediaDevices.getUserMedia({audio : true}
          ).then(function(stream) {
            document.getElementsById('status').textContent = 'Microphone active. Listening...';
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);
            analyser.fftSize = 2048;
            const dataArray = new Uint8Array(analyser.fftSize);
            mic.connect(analyser);

            function checkSound() {
              analyser.getByteFrequencyData(dataArray);
              let soundDetected = false;
              for (let i = 0; i < dataArray.length; i++) {
              const deviation = dataArray[i] - 128;
              sum += deviation * deviation;
              }
              const volume = Math.sqrt(sum / dataArray.length);

                if (volume > 10) {
                  document.getElementById('status').textContent = '‚ö†Ô∏è ALARM! Unusual sound activity detected!';
                  document.getElementById('status').style.color = 'red';
                } else {
                  document.getElementById('status').textContent = 'üéß Listening... (Normal)';
                  document.getElementById('status').style.color = 'green';
                }
                 requestAnimationFrame(detectSound); // ensure loop continues
        }

        detectSound();
      })
      .catch(function(err) {
        document.getElementById('status').textContent = "Microphone access denied.";
        document.getElementById('status').style.color = "green";
      });
  </script>
</body>
